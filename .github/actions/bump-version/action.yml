name: Bump version
description: Bumps the version in package.json and creates a git tag

inputs:
  bump:
    description: 'Version bump type'
    required: true

  github-token:
    description: 'GitHub token'
    required: true

outputs:
  new_version:
    description: 'The new version that was created'
    value: ${{ steps.bump.outputs.new_version }}

runs:
  using: 'composite'
  steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Install dependencies
      uses: nightstem/nightstem-web/.github/actions/install-dependencies@main
      with:
        github-token: ${{ inputs.github-token }}

    - name: Bump version and create tag
      id: bump
      shell: bash
      run: |
        # Configure git to use the provided GitHub App token
        git remote set-url origin https://x-access-token:${GITHUB_TOKEN}@github.com/nightstem/nightstem-web.git

        git config user.name "nightstem[bot]"
        git config user.email "nightstem[bot]@users.noreply.github.com"

        NEW_VERSION=$(npm version ${{ inputs.bump }} -m "chore(release): bump version to %s")
        echo "new_version=$NEW_VERSION" >> $GITHUB_OUTPUT
        git push origin HEAD --follow-tags
      env:
        GITHUB_TOKEN: ${{ inputs.github-token }}
